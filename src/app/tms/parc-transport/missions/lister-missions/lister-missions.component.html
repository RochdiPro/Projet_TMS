<div class="position-relative custom-control">
    <section>
        <mat-form-field class="custom-width" [formGroup]="form">
            <mat-label>Filtre Chauffeur</mat-label>
            <input matInput placeholder="Nom" formControlName="nom" (keyup)="filtrerMission()" id="nom"
                (focus)="nomFiltre = true">
            <button mat-button matSuffix mat-icon-button aria-label="Filtre" (click)="viderNom()">
                <i class="fa fa-filter" aria-hidden="true"></i>
            </button>
        </mat-form-field>
        <mat-form-field class="custom-width" [formGroup]="form">
            <mat-label>Filtre Matricule</mat-label>
            <input matInput placeholder="Matricule" formControlName="matricule" (keyup)="filtrerMission()"
                (focus)="matriculeFiltre = true">
            <button mat-button matSuffix mat-icon-button aria-label="Filtre" (click)="viderMatricule()">
                <i class="fa fa-filter" aria-hidden="true"></i>
            </button>
        </mat-form-field>
        <mat-form-field class="custom-width">
            <mat-label>Filtre Etat Mission</mat-label>
            <mat-select [(value)]="filtreEtatMission" (selectionChange)="etatMissionFiltre= true; filtrerMission();">
                <mat-option></mat-option>
                <mat-option value="Accordée">Accordée</mat-option>
                <mat-option value="En Cours">En Cours</mat-option>
                <mat-option value="Terminée">Terminée</mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field class="custom-width" [formGroup]="form">
            <mat-label>Date de Livraison</mat-label>
            <input matInput [matDatepicker]="picker1" formControlName="dateL" (dateChange)="filtrerMission()">
            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
            <mat-datepicker #picker1></mat-datepicker>
        </mat-form-field>
        <mat-checkbox class="ml-3" color="primary" [checked]="check" value="true"
            (change)="check=!check; filtrerMission(); disableEnableDate()">
            Filtrer Par Date
        </mat-checkbox>
    </section>
</div>
<div class="mat-elevation-z8">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

        <!-- Position Column -->
        <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
            <td mat-cell *matCellDef="let element"> {{element.id}} </td>
        </ng-container>

        <!-- Colonne Nom -->
        <ng-container matColumnDef="nom">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                Chauffeur
            </th>
            <td mat-cell *matCellDef="let element">
                <ul>
                    <li *ngFor="let chauffeur of  getNomChauffeur(element.nomChauffeur)">
                        {{chauffeur}}
                    </li>
                </ul>
            </td>
        </ng-container>

        <!-- Colonne Matricule -->
        <ng-container matColumnDef="matricule">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                Matricule
            </th>
            <td mat-cell *matCellDef="let element"> 
            <ul>
                <li *ngFor="let matricule of getMatricule(element.matricule)">
                    {{matricule}}
                </li>
            </ul>    
            </td>
        </ng-container>

        <!-- Colonne Date -->
        <ng-container matColumnDef="dateLivraison">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Date de Livraison </th>
            <td mat-cell *matCellDef="let element"> {{element.date | date:'dd-MM-yyyy'}} </td>
        </ng-container>

        <!-- Colonne Trajet -->
        <ng-container matColumnDef="trajet">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Trajet </th>
            <td mat-cell *matCellDef="let element">
                <button class="btn " (click)="ouvrirMap(element.id,'trajet')">
                    <i class="fas fa-road" style="color: #858885;"></i>
                </button>
            </td>
        </ng-container>

        <!-- Colonne etat -->
        <ng-container matColumnDef="etatMission">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="ml-1"> Etat Mission </th>
            <td mat-cell *matCellDef="let element">
                <i class="fas fa-hourglass accorde" *ngIf="element.etat === 'Accordée'" matTooltip="Accordée"
                    matTooltipPosition="after"></i>
                <i class="fas fa-hourglass-half attente" *ngIf="element.etat === 'En Cours'"
                    matTooltip="En Cours" matTooltipPosition="after"></i>
                <i class="fas fa-check-circle termine" *ngIf="element.etat === 'Terminée'" matTooltip="Terminée"
                    matTooltipPosition="after"></i>
            </td>
        </ng-container>
        <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let element">
                <button class="mb-2  btn " *ngIf="element.etatMission === 'Accordée'"><i class="fas fa-play"
                        style="color: #3f6ad8;" matTooltip="Lancer" matTooltipPosition="after"></i></button>
                <button class="mb-2  btn " *ngIf="element.etatMission === 'En Cours'"><i class="fas fa-check"
                        style="color: #00D100;" matTooltip="Terminer" matTooltipPosition="after"></i></button>
                <button class="mb-2  btn " *ngIf="element.etatMission === 'Terminée'" disabled><i
                        class="fas fa-check"></i></button>
                <button class="mb-2  btn "><i class="fas fa-trash" style="color: #FF0000;" matTooltip="Supprimer"
                        matTooltipPosition="after"></i></button>

            </td>
        </ng-container>
        <!-- Colonne detail -->
        <ng-container matColumnDef="Detail">
            <th mat-header-cell *matHeaderCellDef> Détails </th>
            <td mat-cell *matCellDef="let element"> <button class="mb-2  btn "><i class="fas fa-info-circle"
                        (click)='detailDialog(element.idE, element.id)' style="color: #3f6ad8;"></i></button></td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>


    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
</div>